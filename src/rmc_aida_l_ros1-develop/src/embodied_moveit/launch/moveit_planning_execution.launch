<?xml version="1.0"?>
<launch>
  
  <!-- 标签 -->
  <arg name="arm_type" default="rm65"/>
  <arg name="end_effector" default="rmg24"/>
  <arg name="real_arm" default="true"/> <!-- 新增参数 -->


  <arg name="R_Arm_IP"                   default="169.254.128.19"/>    <!-- 设置TCP连接时的IP -->
  <arg name="R_Arm_Port"                 default="8080"/>            <!-- 设置TCP连接时的端口 -->
  <arg name="L_Arm_IP"                   default="169.254.128.18"/>    <!-- 设置TCP连接时的IP -->
  <arg name="L_Arm_Port"                 default="8080"/>            <!-- 设置TCP连接时的端口 -->
  <arg name="Follow"                   default="true"/>           <!-- 高低跟随设置 false：低跟随 true：高跟随 -->
  <arg name="Udp_IP"                   default="169.254.128.22"/>    <!-- 设置udp主动上报IP -->
  <arg name="R_Udp_Port"                 default="8089"/>            <!-- 设置udp主动上报端口 -->
  <arg name="L_Udp_Port"                 default="8099"/>            <!-- 设置udp主动上报端口 -->
  <arg name="Udp_cycle"                default="5"/>               <!-- 设置udp主动上报周期（ms） 最低为5(200Hz)，需要为5的倍数 -->
  <arg name="Udp_force_coordinate"     default="0"/>               <!-- 设置六维力参考坐标系 -->
  <arg name="Udp_hand"                 default="false"/>           <!-- 设置灵巧手udp主动上报使能 -->
  <arg name="Udp_plus_state"           default="false"/>           <!-- 设置末端设备实时信息udp主动上报使能 -->
  <arg name="Udp_plus_base"            default="false"/>           <!-- 设置末端 -->
  <arg name="trajectory_mode"          default="0"/>               <!-- 设置高跟随模式下，支持多种模式，0-完全透传模式、1-曲线拟合模式、2-滤波模式-->
  <arg name="radio"                    default="0"/>               <!-- 设置曲线拟合模式下平滑系数（范围0-100）或者滤波模式下的滤波参数（范围0-1000），数值越大表示平滑效果越好-->         


  <arg name="Arm_Dof" value="$(eval '6' if arg('arm_type') == 'rm65' else '7')"/>
  <arg name="Arm_Type" value="$(eval 'RM65' if arg('arm_type') == 'rm65' else 'RM75')"/>
  <!-- 右臂关节列表 -->
  <arg name="r_arm_joints" value="[r_joint1, r_joint2, r_joint3, r_joint4, r_joint5, r_joint6]" if="$(eval arg('arm_type') == 'rm65')"/>
  <arg name="r_arm_joints" value="[r_joint1, r_joint2, r_joint3, r_joint4, r_joint5, r_joint6, r_joint7]" unless="$(eval arg('arm_type') == 'rm65')"/>

  <!-- 左臂关节列表 -->
  <arg name="l_arm_joints" value="[l_joint1, l_joint2, l_joint3, l_joint4, l_joint5, l_joint6]" if="$(eval arg('arm_type') == 'rm65')"/>
  <arg name="l_arm_joints" value="[l_joint1, l_joint2, l_joint3, l_joint4, l_joint5, l_joint6, l_joint7]" unless="$(eval arg('arm_type') == 'rm65')"/>

  <node ns="r_arm" pkg="arm_control" name="arm_control" type="arm_control" output="screen">
      <param name="Arm_Dof"           value="$(arg Arm_Dof)"/>  
  </node>
  <node ns="l_arm" pkg="arm_control" name="arm_control" type="arm_control" output="screen">
      <param name="Arm_Dof"           value="$(arg Arm_Dof)"/>  
  </node>


  <!-- 启动机械臂底层驱动节点 -->
  <node ns="r_arm" name="arm_driver" pkg="embodied_arm_driver" type="arm_driver" output="screen" respawn="false">
      <!-- 机器人坐标frame -->
      <param name="Arm_IP"                value="$(arg R_Arm_IP)"/> 
      <param name="Arm_Port"              value="$(arg R_Arm_Port)"/>   
      <param name="Arm_Dof"               value="$(arg Arm_Dof)"/>   
      <param name="Arm_Type"              value="$(arg Arm_Type)"/> 
      <param name="Follow"                value="$(arg Follow)"/>  
      <param name="Udp_IP"                value="$(arg Udp_IP)"/>   
      <param name="Udp_Port"              value="$(arg R_Udp_Port)"/>  
      <param name="Udp_cycle"             value="$(arg Udp_cycle)"/>  
      <param name="Udp_force_coordinate"  value="$(arg Udp_force_coordinate)"/>
      <param name="Udp_hand"              value="$(arg Udp_hand)"/>
      <param name="Udp_plus_state"        value="$(arg Udp_plus_state)"/>
      <param name="Udp_plus_base"         value="$(arg Udp_plus_base)"/>
      <param name="trajectory_mode"       value="$(arg trajectory_mode)"/>
      <param name="radio"                 value="$(arg radio)"/>  
      <rosparam param="arm_joints" subst_value="true">$(arg r_arm_joints)</rosparam>
  </node>

  <!-- 启动机械臂底层驱动节点 -->
  <node ns="l_arm" name="arm_driver" pkg="embodied_arm_driver" type="arm_driver" output="screen" respawn="false">
    <!-- 机器人坐标frame -->
    <param name="Arm_IP"                value="$(arg L_Arm_IP)"/> 
    <param name="Arm_Port"              value="$(arg L_Arm_Port)"/>   
    <param name="Arm_Dof"               value="$(arg Arm_Dof)"/>   
    <param name="Arm_Type"              value="$(arg Arm_Type)"/> 
    <param name="Follow"                value="$(arg Follow)"/>  
    <param name="Udp_IP"                value="$(arg Udp_IP)"/>   
    <param name="Udp_Port"              value="$(arg L_Udp_Port)"/>  
    <param name="Udp_cycle"             value="$(arg Udp_cycle)"/>  
    <param name="Udp_force_coordinate"  value="$(arg Udp_force_coordinate)"/>
    <param name="Udp_hand"              value="$(arg Udp_hand)"/>
    <param name="Udp_plus_state"        value="$(arg Udp_plus_state)"/>
    <param name="Udp_plus_base"         value="$(arg Udp_plus_base)"/>
    <param name="trajectory_mode"       value="$(arg trajectory_mode)"/>
    <param name="radio"                 value="$(arg radio)"/>  
    <rosparam param="arm_joints" subst_value="true">$(arg l_arm_joints)</rosparam>
</node>
  
<include file="$(find embodied_moveit)/launch/demo_realrobot.launch">
  <arg name="arm_type" value="$(arg arm_type)"/>       <!-- 新增 -->
  <arg name="end_effector" value="$(arg end_effector)"/><!-- 新增 -->
  <arg name="real_arm" value="$(arg real_arm)"/> <!-- 传递real_arm参数 -->
</include>


</launch>
